---
import MainLayout from '../../layouts/MainLayout.astro';

interface MarkdownModule {
  frontmatter: {
    title: string;
    date: string;
    description?: string;
  };
  Content: any;
}

export async function getStaticPaths() {
  const posts = import.meta.glob('../../content/polizas/*.md', { eager: true });

  return Object.entries(posts).map(([path]) => {
    const slug = path.split('/').pop()!.replace('.md', '');
    return { params: { slug } };
  });
}

const { slug } = Astro.params;

const posts = import.meta.glob('../../content/polizas/*.md', { eager: true });

const postEntry = Object.entries(posts).find(([path]) =>
  path.includes(`${slug}.md`)
);

if (!postEntry) {
  throw new Error(`Post no encontrado: ${slug}`);
}

const postModule = postEntry[1] as MarkdownModule;
---

<MainLayout title={postModule.frontmatter.title}>
  <article class="max-w-4xl mx-auto px-6 py-16 text-balance leading-relaxed bg-white text-black font-poppins rounded-lg">
    <h1 class="mb-6 font-extrabold text-4xl font-raleway text-dorado-secundario">
      {postModule.frontmatter.title}
    </h1>
    <time
      class="block mb-8 text-sm text-gray-500 dark:text-gray-400"
      datetime={postModule.frontmatter.date}
    >
      {new Date(postModule.frontmatter.date).toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
      })}
    </time>

    <postModule.Content />
  </article>
</MainLayout>
