---
// VentajasSection.astro - Mobile Touch Optimized con mejoras de accesibilidad
const cards = [
  {
    n: '01',
    title: 'Misión',
    text: 'Ser el despacho líder y referente en protección jurídica de arrendamientos, reconocido por nuestra eficacia, profesionalismo y la tranquilidad que brindamos a nuestros clientes.',
    img: '../../images/office.jpg',
    overlay: 'from-midnight/60 via-blue-800/60 to-blue-900/60',
    textColor: 'group-[.active]:text-blue-100',
    alt: 'Oficina moderna con equipo de trabajo reunido'
  },
  {
    n: '02',
    title: 'Visión',
    text: 'Proporcionar soluciones jurídicas integrales en materia de arrendamiento, a través de la emisión y gestión de pólizas jurídicas que salvaguardan los intereses de propietarios e inquilinos.',
    img: '../../images/vision.jpg',
    overlay: 'from-midnight/60 via-blue-800/60 to-blue-900/60',
    textColor: 'group-[.active]:text-indigo-100',
    alt: 'Ciudad iluminada al atardecer representando visión de futuro'
  },
  {
    n: '03',
    title: 'Nuestros Valores',
    text: 'Confianza, eficacia, profesionalismo, transparencia y compromiso. Actuamos con honestidad y rapidez, comunicando siempre con claridad y protegiendo tus derechos y arrendamientos como propios.',
    img: '../../images/valores.jpg',
    overlay: 'from-midnight/60 via-blue-800/60 to-blue-900/60',
    textColor: 'group-[.active]:text-purple-100',
    alt: 'Manos unidas simbolizando valores y colaboración'
  }
];
---

<section 
  id="ventajas" 
  class="bg-gradient-to-br from-slate-50 to-blue-50/30 py-16 px-4 md:px-8"
  aria-labelledby="ventajas-title"
>
  <div data-aos="fade-zoom-in" data-aos-duration="600" class="max-w-5xl mx-auto">
    
    <header class="text-center mb-12">
      <h2 
        id="ventajas-title" 
        class="text-2xl md:text-4xl font-raleway font-bold text-midnight mb-3 leading-tight"
      >
        Confíe en
        <span class="text-dorado-secundario">RentSolution</span>
      </h2>
      <p 
        class="text-sm font-poppins md:text-lg font-thin text-gray-600 max-w-3xl mx-auto leading-relaxed"
      >
        Protección integral para su propiedad
      </p>
    </header>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 p-2">
      {cards.map((card, index) => (
        <article
          class={`group relative bg-white rounded-xl shadow-lg shadow-midnight 
                  hover:shadow-xl transition-all duration-500 overflow-hidden border border-slate-200/50 
                  w-full min-h-[320px] flex flex-col cursor-pointer touch-manipulation
                  card-interactive`}
          data-card={index}
          role="button"
          tabindex="0"
          aria-pressed="false"
          aria-label={`${card.title}: ${card.text}`}
        >
          
          {/* Imagen de fondo accesible */}
          <div class="absolute inset-0 opacity-0 
                      group-hover:opacity-100 group-[.active]:opacity-100
                      transition-opacity duration-700 ease-out card-overlay"
               aria-hidden="true"
          >
            <div 
              class="absolute inset-0 bg-cover bg-center 
                        scale-110 group-hover:scale-100 group-[.active]:scale-100
                        transition-transform duration-700 ease-out" 
              style={`background-image: url('${card.img}')`}
              role="img"
              aria-label={card.alt}
            >
            </div>
            <div class={`absolute inset-0 bg-gradient-to-br ${card.overlay}`}></div>
          </div>

          {/* Contenido */}
          <div class="relative z-10 p-4 flex flex-col justify-between h-full 
                      text-midnight group-hover:text-white group-[.active]:text-white
                      transition-colors duration-500 card-content">
            <div>
              <div class="flex items-start justify-between mb-2">
                <span 
                  class="text-xl md:text-3xl font-montserrat font-extrabold 
                         text-slate-500 group-hover:text-white/60 group-[.active]:text-white/60
                         transition-colors duration-500 card-number"
                  aria-hidden="true"
                >
                  {card.n}
                </span>
              </div>
              
              <h3 
                class="text-md font-raleway font-extrabold mb-1 
                       text-dorado-secundario group-hover:text-white group-[.active]:text-white
                       transition-colors duration-500 leading-tight card-title"
              >
                {card.title}
              </h3>
              
              <p 
                class={`text-sm mt-2 font-poppins text-balance font-light 
                         text-midnight transition-colors duration-500 leading-relaxed
                         group-hover:text-white group-[.active]:text-white ${card.textColor} card-text`}
              >
                {card.text}
              </p>
            </div>
          </div>
        </article>
      ))}
    </div>
  </div>
</section>

<script>
  function initCardInteractions() {
    const cards = document.querySelectorAll('.card-interactive');
    let activeCard = null;
    let touchTimeout = null;
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    cards.forEach((card) => {
      if (isTouchDevice) {
        card.addEventListener('touchstart', (e) => {
          e.preventDefault();
          clearTimeout(touchTimeout);
          cards.forEach(c => {
            c.classList.remove('active');
            c.setAttribute('aria-pressed', 'false');
          });
          card.classList.add('active');
          card.setAttribute('aria-pressed', 'true');
          activeCard = card;
        }, { passive: false });

        card.addEventListener('touchend', (e) => {
          e.preventDefault();
          touchTimeout = setTimeout(() => {
            if (activeCard === card) {
              card.classList.remove('active');
              card.setAttribute('aria-pressed', 'false');
              activeCard = null;
            }
          }, 2000);
        }, { passive: false });

        card.addEventListener('click', (e) => {
          e.preventDefault();
          const isActive = card.classList.contains('active');
          cards.forEach(c => {
            c.classList.remove('active');
            c.setAttribute('aria-pressed', 'false');
          });
          if (!isActive) {
            card.classList.add('active');
            card.setAttribute('aria-pressed', 'true');
            activeCard = card;
            clearTimeout(touchTimeout);
            touchTimeout = setTimeout(() => {
              card.classList.remove('active');
              card.setAttribute('aria-pressed', 'false');
              activeCard = null;
            }, 3000);
          }
        });
      }

      if (!isTouchDevice) {
        card.addEventListener('mouseenter', () => {
          cards.forEach(c => {
            c.classList.remove('active');
            c.setAttribute('aria-pressed', 'false');
          });
        });
      }
    });

    document.addEventListener('touchstart', (e) => {
      if (activeCard && !activeCard.contains(e.target)) {
        activeCard.classList.remove('active');
        activeCard.setAttribute('aria-pressed', 'false');
        activeCard = null;
        clearTimeout(touchTimeout);
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && activeCard) {
        activeCard.classList.remove('active');
        activeCard.setAttribute('aria-pressed', 'false');
        activeCard = null;
        clearTimeout(touchTimeout);
      }
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCardInteractions);
  } else {
    initCardInteractions();
  }
  document.addEventListener('astro:page-load', initCardInteractions);
</script>

<style>
  .card-interactive {
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }
  .card-interactive.active {
    transform: scale(0.98);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }
  .card-interactive.active .card-overlay { opacity: 1; }
  .card-interactive.active .card-content,
  .card-interactive.active .card-title,
  .card-interactive.active .card-text,
  .card-interactive.active .card-number { color: white; }
  .card-interactive.active .card-number { color: rgba(255, 255, 255, 0.6); }
  .card-interactive.active .card-overlay > div:first-child { transform: scale(1); }
  @media (max-width: 640px) {
    .card-interactive { min-height: 280px; }
    .card-interactive.active { transform: scale(0.99); }
  }
  .card-interactive:focus-visible {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }
</style>
